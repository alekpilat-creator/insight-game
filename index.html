<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Insight Engine</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { margin:0; background:#000; color:#fff; font-family:system-ui; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; text-align:center; padding:10px 20px; overflow-y:auto; }
    h1 { font-size:2.5em; margin:20px 0; text-shadow:0 0 40px #a855f7; animation:glow 2s infinite alternate; }
    @keyframes glow { 0% { text-shadow:0 0 30px #a855f7; } 100% { text-shadow:0 0 60px #ec4899; } }
    #brain { width:400px; height:400px; max-width:80vw; margin:10px auto; filter:drop-shadow(0 0 80px #a855f7); animation:pulse 3s infinite alternate; }
    @keyframes pulse { 0% { transform:scale(1); } 100% { transform:scale(1.08); } }
    .coins { font-size:4em; font-weight:bold; margin:20px 0; }
    #bar { width:90%; max-width:450px; height:50px; background:#111; border-radius:25px; overflow:hidden; position:relative; margin:20px auto; }
    #fill { height:100%; background:linear-gradient(90deg,#a855f7,#ec4899); transition:width .5s ease; }
    #energy { position:absolute; top:0; left:50%; transform:translateX(-50%); line-height:50px; font-size:1.8em; font-weight:bold; }
    #tap { width:300px; height:300px; background:#a855f7; border-radius:50%; border:none; color:#fff; font-size:4.5em; font-weight:bold; box-shadow:0 0 100px #a855f7; cursor:pointer; margin:20px auto; transition:all .1s; }
    #tap:active { transform:scale(0.9); box-shadow:0 0 150px #ec4899; }
    button { background:#22c55e; color:#fff; border:none; padding:15px 35px; border-radius:40px; font-size:1.5em; font-weight:bold; margin:10px; cursor:pointer; box-shadow:0 10px 30px rgba(34,197,94,.6); transition:all .2s; }
    button:active { transform:scale(0.95); }
    .boost { background:#fbbf24; color:#000; box-shadow:0 10px 30px rgba(251,191,36,.6); }
    .confetti { position:absolute; width:8px; height:8px; background:#f72585; pointer-events:none; animation:confetti 3s ease-out forwards; }
    @keyframes confetti { 0% { transform:translateY(0) rotate(0); opacity:1; } 100% { transform:translateY(100vh) rotate(720deg); opacity:0; } }
  </style>
</head>
<body>
  <h1>Insight Engine</h1>
  <img id="brain" src="brain.jpg" alt="Glowing Brain">
  <div class="coins"><span id="coins">0</span> $INSIGHT</div>
  <div id="bar"><div id="fill"></div><div id="energy">1000 / 1000</div></div>
  <button id="tap">TAP</button>
  <button class="boost" onclick="buyBoost()">Boost ×2 (500 Stars)</button>
  <button onclick="invite()">Invite Friends (+10k)</button>

  <script>
    let coins = 0, energy = 1000, max = 1000;
    function update() {
      document.getElementById('coins').textContent = coins.toLocaleString();
      document.getElementById('energy').textContent = energy + ' / ' + max;
      document.getElementById('fill').style.width = (energy/max*100)+'%';
      if (window.Telegram?.WebApp?.MainButton) Telegram.WebApp.MainButton.setText(`Withdraw ${coins.toLocaleString()} $INSIGHT`);
    }
    setInterval(()=>{if(energy<max){energy+=3;update();}},1000);

    function createConfetti() {
      for (let i = 0; i < 30; i++) {
        const c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random() * 100 + 'vw';
        c.style.background = ['#a855f7','#ec4899','#22c55e','#fbbf24'][Math.floor(Math.random()*4)];
        c.style.animationDelay = Math.random()*0.5 + 's';
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 3000);
      }
    }

    // TAP działa po załadowaniu DOM i SDK
    function initTap() {
      const tapButton = document.getElementById('tap');
      if (tapButton) {
        tapButton.onclick = () => {
          if (energy >= 1) {
            if (window.Telegram?.WebApp?.HapticFeedback) Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
            coins++;
            energy--;
            createConfetti();
            update();
          }
        };
      }
    }

    document.addEventListener('DOMContentLoaded', initTap);

    // Re-init po Telegram ready
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      Telegram.WebApp.MainButton.show();
      Telegram.WebApp.onEvent('viewportChanged', initTap);
    }

    update();
  </script>
</body>
</html>
